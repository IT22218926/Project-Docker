http_port 0.0.0.0:3128

# ACLs
acl localnet src 192.168.8.0/24
acl localnet src 172.18.0.0/16   # add Docker internal subnet
acl localhost src 127.0.0.1/32 ::1
acl SSL_ports port 443
acl Safe_ports port 80 443
acl CONNECT method CONNECT

http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports
http_access allow localhost
http_access allow localnet
http_access deny all

# Memory cache
cache_mem 128 MB
maximum_object_size_in_memory 512 KB

# Disk cache (100MB)
cache_dir ufs /var/spool/squid 100 16 256
maximum_object_size 4 MB

# Refresh patterns
refresh_pattern . 0 20% 4320

# Logs
access_log stdio:/var/log/squid/access.log
cache_log  stdio:/var/log/squid/cache.log

# Stability / DNS
dns_nameservers 8.8.8.8 8.8.4.4
max_filedescriptors 65536
coredump_dir /var/spool/squid
